import{a as Ie,b as Ve,d as je,e as ne,f as Le,g as oe,h as Re,j as $e,k as Be,l as ze}from"./chunk-5JN3NVF4.js";import{a as Ee,b as ie,c as Pe,d as Ce,e as ye,f as ke,g as De,h as we,i as Te,j as Ne,k as Me}from"./chunk-K6HC6ABD.js";import{G as O}from"./chunk-65T2XKK6.js";import{a as Ae}from"./chunk-PRIAAN6C.js";import{e as he,g as xe,h as H,k as Fe,l as Se,n as A}from"./chunk-YGVZ7NKW.js";import{$ as P,$a as x,$b as be,A as $,Aa as G,Bb as y,Cb as M,Da as s,Db as ve,F as le,Hb as fe,I as Z,Ib as _e,K as B,Mb as k,Q as z,Qa as C,V as v,_ as E,_a as h,a as X,aa as j,ab as ce,b as Y,ba as L,bb as D,cb as w,db as u,eb as a,fb as r,gb as f,hb as m,ib as p,jb as te,ka as _,kb as T,lb as me,ma as ee,mb as g,n as I,na as q,o as b,ob as c,s as V,sb as de,ub as pe,vb as ue,wb as o,xb as F,yb as N,zb as ge}from"./chunk-PMUFEJA4.js";var U=class i{activatedRoute=v(he);currentPage=Se(this.activatedRoute.queryParamMap.pipe(V(t=>t.get("page")?+t.get("page"):1),V(t=>isNaN(t)?1:t)),{initialValue:1});static \u0275fac=function(e){return new(e||i)};static \u0275prov=z({token:i,factory:i.\u0275fac,providedIn:"root"})};var re=()=>[],ae=i=>({page:i});function He(i,t){if(i&1){let e=T();a(0,"button",3),g("click",function(){let l=E(e).$implicit,d=c();return P(d.activePage.set(l))}),o(1),r()}if(i&2){let e=t.$implicit,n=c();pe("btn-primary",e===n.activePage()),u("routerLink",y(5,re))("queryParams",M(6,ae,e)),s(),N(" ",e," ")}}var W=class i{pages=k(0);currentPage=k(1);activePage=_e(this.currentPage);getPagesList=fe(()=>{let t=this.pages(),e=this.activePage();if(t<=5)return Array.from({length:t},(d,S)=>S+1);let n=Math.max(1,e-2),l=Math.min(t,n+4);return Array.from({length:l-n+1},(d,S)=>n+S)});previousPage(){this.activePage()>1&&this.activePage.update(t=>t-1)}nextPage(){this.activePage()<this.pages()&&this.activePage.update(t=>t+1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-pagination"]],inputs:{pages:[1,"pages"],currentPage:[1,"currentPage"]},decls:7,vars:12,consts:[[1,"join","flex","justify-center","items-center","gap-2"],[1,"join-item","btn",3,"click","routerLink","queryParams","disabled"],[1,"join-item","btn",3,"btn-primary","routerLink","queryParams"],[1,"join-item","btn",3,"click","routerLink","queryParams"]],template:function(e,n){e&1&&(a(0,"div",0)(1,"button",1),g("click",function(){return n.previousPage()}),o(2,"\xAB"),r(),D(3,He,2,8,"button",2,ce),a(5,"button",1),g("click",function(){return n.nextPage()}),o(6,"\xBB"),r()()),e&2&&(s(),u("routerLink",y(6,re))("queryParams",M(7,ae,n.activePage()-1))("disabled",n.activePage()===1),s(2),w(n.getPagesList()),s(2),u("routerLink",y(9,re))("queryParams",M(10,ae,n.activePage()+1))("disabled",n.activePage()===n.pages()))},dependencies:[H],encapsulation:2,changeDetection:0})};var J=class i{simpsonsCount=k.required();totalPages=k.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-hero-simpsons"]],inputs:{simpsonsCount:[1,"simpsonsCount"],totalPages:[1,"totalPages"]},decls:28,vars:2,consts:[["role","banner",1,"hero","bg-linear-to-r","from-yellow-400","via-yellow-500","to-orange-400","text-base-content"],[1,"hero-content","text-center","py-12"],[1,"max-w-md"],[1,"text-5xl","font-bold","text-black","drop-shadow-md"],[1,"py-6","text-lg","text-gray-800","font-medium"],[1,"stats","stats-horizontal","shadow-lg","bg-white/90"],[1,"stat"],[1,"stat-figure","text-primary"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"inline-block","w-8","h-8","stroke-current"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0zM7 10a2 2 0 11-4 0 2 2 0z"],[1,"stat-title","text-gray-700"],[1,"stat-value","text-primary"],[1,"stat-desc","text-gray-600"],[1,"stat-figure","text-secondary"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"stat-value","text-secondary"]],template:function(e,n){e&1&&(m(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),o(4,"The Simpsons"),p(),m(5,"p",4),o(6," Explora el universo de la familia m\xE1s famosa de Springfield "),p(),m(7,"div",5)(8,"div",6)(9,"div",7),j(),m(10,"svg",8),te(11,"path",9),p()(),L(),m(12,"div",10),o(13,"Personajes"),p(),m(14,"div",11),o(15),p(),m(16,"div",12),o(17,"Total de registros"),p()(),m(18,"div",6)(19,"div",13),j(),m(20,"svg",8),te(21,"path",14),p()(),L(),m(22,"div",10),o(23,"P\xE1ginas"),p(),m(24,"div",15),o(25),p(),m(26,"div",12),o(27,"Total disponibles"),p()()()()()()),e&2&&(s(15),N(" ",n.simpsonsCount()," "),s(10),F(n.totalPages()))},encapsulation:2,changeDetection:0})};var Oe=(i,t)=>t.label;function Ue(i,t){if(i&1&&(m(0,"a",1),o(1),p()),i&2){let e=c().$implicit;me("href",e.link,G),s(),F(e.label)}}function We(i,t){if(i&1&&(m(0,"span"),o(1),p()),i&2){let e=c().$implicit;s(),F(e.label)}}function Je(i,t){if(i&1&&(m(0,"li"),h(1,Ue,2,2,"a",1)(2,We,2,1,"span"),p()),i&2){let e=t.$implicit;s(),x(e.link?1:2)}}var K=class i{items=k([]);static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-breadcrumbs"]],inputs:{items:[1,"items"]},decls:4,vars:0,consts:[[1,"breadcrumbs","text-sm","px-6","py-3","bg-base-200"],[1,"link","link-hover",3,"href"]],template:function(e,n){e&1&&(m(0,"div",0)(1,"ul"),D(2,Je,3,1,"li",null,Oe),p()()),e&2&&(s(2),w(n.items()))},encapsulation:2,changeDetection:0})};var Q=class i{firestore=v(Ve);authService=v(O);favorites=_([]);loading=_(!1);addFavorite(t,e,n){return this.authService.user$.pipe(le(),Z(l=>{if(!l||!l.uid)throw new Error("auth/user-not-authenticated");let d={nombre:t,customName:n||t,image:e,userId:l.uid,createdAt:new Date},S=ne(this.firestore,"favorites");return I(je(S,Y(X({},d),{createdAt:Ie.fromDate(d.createdAt)})))}))}getFavorites(){return this.authService.user$.pipe(Z(t=>{if(!t||!t.uid)return this.favorites.set([]),b([]);this.loading.set(!0);let e=ne(this.firestore,"favorites"),n=$e(e,ze("userId","==",t.uid));return I(Re(n)).pipe(V(l=>{let d=l.docs.map(S=>Y(X({id:S.id},S.data()),{createdAt:S.data().createdAt.toDate()}));return this.favorites.set(d),this.loading.set(!1),d}))}))}deleteFavorite(t){let e=oe(this.firestore,"favorites",t);return I(Le(e))}updateFavorite(t,e){let n=oe(this.firestore,"favorites",t);return I(Be(n,{customName:e}))}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=z({token:i,factory:i.\u0275fac,providedIn:"root"})};var Ke=()=>({label:"Inicio",link:"/"}),Qe=()=>({label:"Simpsons",link:"/simpsons"}),Xe=()=>({label:"Personajes"}),Ye=(i,t,e)=>[i,t,e],Ze=i=>["/simpsons",i],Ge=(i,t)=>t.id;function et(i,t){i&1&&f(0,"span",10)}function tt(i,t){i&1&&o(0," \u{1F504} Actualizar ")}function it(i,t){i&1&&(a(0,"div",11),f(1,"span",16),r())}function nt(i,t){i&1&&(a(0,"div",12),j(),a(1,"svg",17),f(2,"path",18),r(),L(),a(3,"span"),o(4,"No tienes favoritos a\xFAn. \xA1Agrega algunos personajes!"),r()())}function ot(i,t){if(i&1){let e=T();a(0,"form",24),f(1,"input",25),a(2,"div",26)(3,"button",27),g("click",function(){E(e);let l=c(3);return P(l.saveEditedFavorite())}),o(4," \u2713 Guardar "),r(),a(5,"button",28),g("click",function(){E(e);let l=c(3);return P(l.cancelEditingFavorite())}),o(6," \u2715 Cancelar "),r()()()}if(i&2){let e=c(3);u("formGroup",e.editForm)}}function rt(i,t){if(i&1){let e=T();a(0,"p",29)(1,"span",30),o(2,"Nombre personalizado:"),r(),f(3,"br"),o(4),r(),a(5,"div",31)(6,"button",32),g("click",function(){E(e);let l=c().$implicit,d=c(2);return P(d.startEditingFavorite(l))}),o(7," \u270F\uFE0F Editar "),r(),a(8,"button",33),g("click",function(){E(e);let l=c().$implicit,d=c(2);return P(d.removeFromFavorites(l.id))}),o(9," \u{1F5D1}\uFE0F Eliminar "),r()()}if(i&2){let e=c().$implicit;s(4),N(" ",e.customName," ")}}function at(i,t){if(i&1&&(a(0,"div",19)(1,"figure",20),f(2,"img",21),r(),a(3,"div",22)(4,"h3",23),o(5),r(),h(6,ot,7,1,"form",24)(7,rt,10,1),r()()),i&2){let e=t.$implicit,n=c(2);s(2),u("src",e.image,G)("alt",e.nombre),s(3),F(e.nombre),s(),x(n.editingFavoriteId()===e.id?6:7)}}function st(i,t){if(i&1&&(a(0,"div",13),D(1,at,8,4,"div",19,Ge),r()),i&2){let e=c();s(),w(e.favorites())}}function lt(i,t){if(i&1){let e=T();a(0,"div",14)(1,"select",34,0),g("change",function(){E(e);let l=de(2),d=c();return P(d.charactersPerPage.set(+l.value))}),a(3,"option",35),o(4,"10"),r(),a(5,"option",36),o(6,"20"),r(),a(7,"option",37),o(8,"50"),r(),a(9,"option",38),o(10,"100"),r()(),f(11,"app-pagination",39)(12,"div",40),r()}if(i&2){let e=c();s(11),u("pages",e.totalPages())("currentPage",e.paginationService.currentPage())}}function ct(i,t){i&1&&(a(0,"button",43),o(1," \u2B50 En favoritos "),r())}function mt(i,t){i&1&&f(0,"span",10)}function dt(i,t){if(i&1){let e=T();a(0,"button",45),g("click",function(){E(e);let l=c().$implicit,d=c(2);return P(d.addToFavorites(l))}),h(1,mt,1,0,"span",10),o(2," \u2B50 Agregar "),r()}if(i&2){let e=c(3);u("disabled",e.addFavoriteResource.isLoading()),s(),x(e.addFavoriteResource.isLoading()?1:-1)}}function pt(i,t){if(i&1&&(a(0,"tr")(1,"td"),o(2),r(),a(3,"td"),o(4),r(),a(5,"td"),o(6),r(),a(7,"td")(8,"span"),o(9),r()(),a(10,"td")(11,"a",42),o(12," Ver Detalle "),r()(),a(13,"td"),h(14,ct,2,0,"button",43)(15,dt,3,2,"button",44),r()()),i&2){let e=t.$implicit,n=c(2);s(2),F(e.id),s(2),F(e.name),s(2),F(e.occupation),s(2),ue(ge("badge badge-",e.status==="Alive"?"success":"error")),s(),N(" ",e.status," "),s(2),u("routerLink",M(9,Ze,e.id)),s(3),x(n.isFavorite(e.name)?14:15)}}function ut(i,t){if(i&1&&(a(0,"div",15)(1,"table",41)(2,"thead")(3,"tr")(4,"th"),o(5,"ID"),r(),a(6,"th"),o(7,"Nombre"),r(),a(8,"th"),o(9,"Ocupaci\xF3n"),r(),a(10,"th"),o(11,"Estado"),r(),f(12,"th"),a(13,"th"),o(14,"Acci\xF3n"),r()()(),a(15,"tbody"),D(16,pt,16,11,"tr",null,Ge),r()()()),i&2){let e=c();s(16),w(e.simpsonsResource.value().results)}}var qe=class i{fb=v(Ne);router=v(xe);simpsonsService=v(Ae);paginationService=v(U);favoritesService=v(Q);authService=v(O);charactersPerPage=_(10);totalPages=_(0);reloadFavoritesTrigger=_(0);addFavoriteAction=_(null);deleteFavoriteAction=_(null);updateFavoriteAction=_(null);editingFavoriteId=_(null);editForm;currentUser=this.authService.user$;constructor(){this.editForm=this.fb.group({customName:["",[ie.required,ie.minLength(2)]]}),ee(()=>{this.simpsonsResource.hasValue()&&this.totalPages.set(this.simpsonsResource.value().pages)}),ee(()=>{this.currentUser.subscribe(t=>{t?this.reloadFavoritesTrigger.update(e=>e+1):this.favoritesService.favorites.set([])})})}simpsonsResource=A({params:()=>({page:this.paginationService.currentPage()-1,limit:this.charactersPerPage()}),stream:({params:t})=>this.simpsonsService.getCharactersOptions({offset:t.page,limit:t.limit})});favoritesResource=A({params:()=>({reload:this.reloadFavoritesTrigger()}),stream:({params:t})=>this.authService.user$?this.favoritesService.getFavorites():b([])});addFavoriteResource=A({params:()=>this.addFavoriteAction(),stream:({params:t})=>t?this.favoritesService.addFavorite(t.nombre,t.imagen).pipe(B(()=>{q(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("\xA1Agregado a favoritos!")})}),$(e=>(console.error("Error al agregar favorito:",e),alert("Error al agregar a favoritos: "+e.message),b(null)))):b(null)});deleteFavoriteResource=A({params:()=>this.deleteFavoriteAction(),stream:({params:t})=>t?this.favoritesService.deleteFavorite(t).pipe(B(()=>{q(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("Eliminado de favoritos")})}),$(e=>(console.error("Error al eliminar favorito:",e),alert("Error al eliminar favorito: "+e.message),b(null)))):b(null)});updateFavoriteResource=A({params:()=>this.updateFavoriteAction(),stream:({params:t})=>t?this.favoritesService.updateFavorite(t.id,t.customName).pipe(B(()=>{q(()=>{this.reloadFavoritesTrigger.update(e=>e+1),this.cancelEditingFavorite(),alert("Nombre actualizado")})}),$(e=>(console.error("Error al actualizar favorito:",e),alert("Error al actualizar: "+e.message),b(null)))):b(null)});favorites=()=>this.favoritesService.favorites()||[];loadingFavorites=this.favoritesResource.isLoading;logout(){this.authService.logout().subscribe({next:()=>this.router.navigate(["/login"]),error:t=>console.error("Error al cerrar sesi\xF3n:",t)})}reloadFavorites(){this.reloadFavoritesTrigger.update(t=>t+1)}addToFavorites(t){let e=t.name||t.character,n=t.portrait_path||t.image||t.img||"",l;if(!e)return alert("Error: Faltan datos (nombre).");n?n.startsWith("http")?l=n:l=`https://cdn.thesimpsonsapi.com/500${n}`:l="https://placehold.co/400x300/a8c2f0/white?text=IMAGEN+API+FALLA",this.addFavoriteAction.set({nombre:e,imagen:l})}removeFromFavorites(t){confirm("\xBFEliminar de favoritos?")&&this.deleteFavoriteAction.set(t)}startEditingFavorite(t){this.editingFavoriteId.set(t.id),this.editForm.patchValue({customName:t.customName})}saveEditedFavorite(){if(this.editForm.invalid){this.editForm.markAllAsTouched();return}let t=this.editingFavoriteId(),e=this.editForm.value.customName;t&&e&&this.updateFavoriteAction.set({id:t,customName:e})}cancelEditingFavorite(){this.editingFavoriteId.set(null),this.editForm.reset()}isFavorite(t){return this.favoritesService.isFavorite(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=C({type:i,selectors:[["app-simpsons-page"]],decls:19,vars:15,consts:[["selectPerPage",""],[1,"p-4"],[3,"items"],[1,"flex","justify-end","p-2","-mt-4"],[1,"btn","btn-outline","btn-error",3,"click"],[3,"simpsonsCount","totalPages"],[1,"mt-8"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-2xl","font-bold"],[1,"btn","btn-sm","btn-ghost",3,"click","disabled"],[1,"loading","loading-spinner","loading-sm"],[1,"flex","justify-center","items-center","py-12"],[1,"alert","alert-info"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"flex","gap-2","items-center","h-20","mb-4","mt-8"],[1,"overflow-x-auto","mt-8"],[1,"loading","loading-spinner","loading-lg"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-current","shrink-0","w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"card","bg-base-100","shadow-xl"],[1,"px-4","pt-4"],["onerror","this.onerror=null; this.src='https://placehold.co/400x300/a8c2f0/white?text=No+Imagen'",1,"rounded-xl","h-48","w-full","object-cover",3,"src","alt"],[1,"card-body"],[1,"card-title","text-sm"],[1,"form-control",3,"formGroup"],["type","text","formControlName","customName","placeholder","Nombre personalizado",1,"input","input-bordered","input-sm"],[1,"flex","gap-2","mt-2"],["type","button",1,"btn","btn-xs","btn-success","flex-1",3,"click"],["type","button",1,"btn","btn-xs","btn-ghost","flex-1",3,"click"],[1,"text-xs","opacity-70"],[1,"font-semibold"],[1,"card-actions","justify-end","mt-2"],[1,"btn","btn-xs","btn-ghost",3,"click"],[1,"btn","btn-xs","btn-error",3,"click"],[1,"select","select-bordered","w-32",3,"change"],["value","10"],["value","20"],["value","50"],["value","100"],[3,"pages","currentPage"],[1,"flex","flex-1"],[1,"table"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],["disabled","",1,"btn","btn-sm","btn-ghost"],[1,"btn","btn-sm","btn-primary",3,"disabled"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"]],template:function(e,n){if(e&1&&(a(0,"section",1),f(1,"app-breadcrumbs",2),a(2,"div",3)(3,"button",4),g("click",function(){return n.logout()}),o(4," \u{1F6AA} Cerrar Sesi\xF3n "),r()(),f(5,"app-hero-simpsons",5),a(6,"section")(7,"div",6)(8,"div",7)(9,"h2",8),o(10,"\u2B50 Mis Favoritos"),r(),a(11,"button",9),g("click",function(){return n.reloadFavorites()}),h(12,et,1,0,"span",10)(13,tt,1,0),r()(),h(14,it,2,0,"div",11)(15,nt,5,0,"div",12)(16,st,3,0,"div",13),r()(),h(17,lt,13,2,"div",14),h(18,ut,18,0,"div",15),r()),e&2){let l;s(),u("items",ve(11,Ye,y(8,Ke),y(9,Qe),y(10,Xe))),s(4),u("simpsonsCount",((l=n.simpsonsResource.value())==null?null:l.count)??0)("totalPages",n.totalPages()),s(6),u("disabled",n.loadingFavorites()),s(),x(n.loadingFavorites()?12:13),s(2),x(n.loadingFavorites()?14:n.favorites().length===0?15:16),s(3),x(n.totalPages()>0?17:-1),s(),x(n.simpsonsResource.hasValue()?18:-1)}},dependencies:[be,Fe,H,W,J,K,Me,ye,we,Te,Ee,Pe,Ce,De,ke],encapsulation:2})};export{qe as SimpsonsPage};
