import{a as Ne,b as Te,d as Me,e as te,f as Ae,g as ie,h as Ie,j as Ve,k as je,l as Le}from"./chunk-N6CIKGOG.js";import{a as xe,b as ee,c as be,d as Fe,e as Se,f as Pe,g as Ee,h as Ce,i as ye,j as ke,k as we}from"./chunk-INHJ2RAY.js";import{G}from"./chunk-SYUZCZJN.js";import{a as De}from"./chunk-AW7COSKP.js";import{e as ve,g as fe,h as B,k as _e,l as he,n as N}from"./chunk-M5KHD7LC.js";import{j as ge}from"./chunk-D2EF2PWG.js";import{$ as F,$a as S,A as L,Aa as ae,Ab as de,Cb as q,Da as l,Db as w,F as re,I as X,Ib as pe,Jb as ue,K as R,Nb as D,Q as z,Qa as k,V as p,_ as b,a as K,aa as A,ab as P,b as Q,ba as I,bb as se,cb as V,db as j,eb as u,fb as r,gb as o,hb as f,ib as d,jb as _,ka as v,kb as Z,lb as E,ma as Y,n as T,na as $,nb as g,o as h,pb as m,s as M,tb as le,vb as me,wb as ce,xb as a,yb as C,zb as y}from"./chunk-OPARH6KU.js";var H=class i{activatedRoute=p(ve);currentPage=he(this.activatedRoute.queryParamMap.pipe(M(t=>t.get("page")?+t.get("page"):1),M(t=>isNaN(t)?1:t)),{initialValue:1});static \u0275fac=function(e){return new(e||i)};static \u0275prov=z({token:i,factory:i.\u0275fac,providedIn:"root"})};var ne=()=>[],oe=i=>({page:i});function qe(i,t){if(i&1){let e=E();r(0,"button",3),g("click",function(){let s=b(e).$implicit,c=m();return F(c.activePage.set(s))}),a(1),o()}if(i&2){let e=t.$implicit,n=m();me("btn-primary",e===n.activePage()),u("routerLink",q(5,ne))("queryParams",w(6,oe,e)),l(),y(" ",e," ")}}var U=class i{pages=D(0);currentPage=D(1);activePage=ue(this.currentPage);getPagesList=pe(()=>{let t=this.pages(),e=this.activePage();if(t<=5)return Array.from({length:t},(c,x)=>x+1);let n=Math.max(1,e-2),s=Math.min(t,n+4);return Array.from({length:s-n+1},(c,x)=>n+x)});previousPage(){this.activePage()>1&&this.activePage.update(t=>t-1)}nextPage(){this.activePage()<this.pages()&&this.activePage.update(t=>t+1)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-pagination"]],inputs:{pages:[1,"pages"],currentPage:[1,"currentPage"]},decls:7,vars:12,consts:[[1,"join","flex","justify-center","items-center","gap-2"],[1,"join-item","btn",3,"click","routerLink","queryParams","disabled"],[1,"join-item","btn",3,"btn-primary","routerLink","queryParams"],[1,"join-item","btn",3,"click","routerLink","queryParams"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"button",1),g("click",function(){return n.previousPage()}),a(2,"\xAB"),o(),V(3,qe,2,8,"button",2,se),r(5,"button",1),g("click",function(){return n.nextPage()}),a(6,"\xBB"),o()()),e&2&&(l(),u("routerLink",q(6,ne))("queryParams",w(7,oe,n.activePage()-1))("disabled",n.activePage()===1),l(2),j(n.getPagesList()),l(2),u("routerLink",q(9,ne))("queryParams",w(10,oe,n.activePage()+1))("disabled",n.activePage()===n.pages()))},dependencies:[B],encapsulation:2,changeDetection:0})};var W=class i{simpsonsCount=D.required();totalPages=D.required();static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-hero-simpsons"]],inputs:{simpsonsCount:[1,"simpsonsCount"],totalPages:[1,"totalPages"]},decls:28,vars:2,consts:[["role","banner",1,"hero","bg-linear-to-r","from-yellow-400","via-yellow-500","to-orange-400","text-base-content"],[1,"hero-content","text-center","py-12"],[1,"max-w-md"],[1,"text-5xl","font-bold","text-black","drop-shadow-md"],[1,"py-6","text-lg","text-gray-800","font-medium"],[1,"stats","stats-horizontal","shadow-lg","bg-white/90"],[1,"stat"],[1,"stat-figure","text-primary"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"inline-block","w-8","h-8","stroke-current"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0zM7 10a2 2 0 11-4 0 2 2 0z"],[1,"stat-title","text-gray-700"],[1,"stat-value","text-primary"],[1,"stat-desc","text-gray-600"],[1,"stat-figure","text-secondary"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"],[1,"stat-value","text-secondary"]],template:function(e,n){e&1&&(d(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),a(4,"The Simpsons"),_(),d(5,"p",4),a(6," Explora el universo de la familia m\xE1s famosa de Springfield "),_(),d(7,"div",5)(8,"div",6)(9,"div",7),A(),d(10,"svg",8),Z(11,"path",9),_()(),I(),d(12,"div",10),a(13,"Personajes"),_(),d(14,"div",11),a(15),_(),d(16,"div",12),a(17,"Total de registros"),_()(),d(18,"div",6)(19,"div",13),A(),d(20,"svg",8),Z(21,"path",14),_()(),I(),d(22,"div",10),a(23,"P\xE1ginas"),_(),d(24,"div",15),a(25),_(),d(26,"div",12),a(27,"Total disponibles"),_()()()()()()),e&2&&(l(15),y(" ",n.simpsonsCount()," "),l(10),C(n.totalPages()))},encapsulation:2,changeDetection:0})};var J=class i{firestore=p(Te);authService=p(G);favorites=v([]);loading=v(!1);addFavorite(t,e,n){return this.authService.user$.pipe(re(),X(s=>{if(!s||!s.uid)throw new Error("auth/user-not-authenticated");let c={nombre:t,customName:n||t,image:e,userId:s.uid,createdAt:new Date},x=te(this.firestore,"favorites");return T(Me(x,Q(K({},c),{createdAt:Ne.fromDate(c.createdAt)})))}))}getFavorites(){return this.authService.user$.pipe(X(t=>{if(!t||!t.uid)return this.favorites.set([]),h([]);this.loading.set(!0);let e=te(this.firestore,"favorites"),n=Ve(e,Le("userId","==",t.uid));return T(Ie(n)).pipe(M(s=>{let c=s.docs.map(x=>Q(K({id:x.id},x.data()),{createdAt:x.data().createdAt.toDate()}));return this.favorites.set(c),this.loading.set(!1),c}))}))}deleteFavorite(t){let e=ie(this.firestore,"favorites",t);return T(Ae(e))}updateFavorite(t,e){let n=ie(this.firestore,"favorites",t);return T(je(n,{customName:e}))}isFavorite(t){return this.favorites().some(e=>e.nombre===t)}static \u0275fac=function(e){return new(e||i)};static \u0275prov=z({token:i,factory:i.\u0275fac,providedIn:"root"})};var Be=i=>["/simpsons",i],$e=(i,t)=>t.id;function Ge(i,t){i&1&&f(0,"span",7)}function He(i,t){i&1&&a(0," \u{1F504} Actualizar ")}function Oe(i,t){i&1&&(r(0,"div",8),f(1,"span",13),o())}function Ue(i,t){i&1&&(r(0,"div",9),A(),r(1,"svg",14),f(2,"path",15),o(),I(),r(3,"span"),a(4,"No tienes favoritos a\xFAn. \xA1Agrega algunos personajes!"),o()())}function We(i,t){if(i&1){let e=E();r(0,"form",21),f(1,"input",22),r(2,"div",23)(3,"button",24),g("click",function(){b(e);let s=m(3);return F(s.saveEditedFavorite())}),a(4," \u2713 Guardar "),o(),r(5,"button",25),g("click",function(){b(e);let s=m(3);return F(s.cancelEditingFavorite())}),a(6," \u2715 Cancelar "),o()()()}if(i&2){let e=m(3);u("formGroup",e.editForm)}}function Je(i,t){if(i&1){let e=E();r(0,"p",26)(1,"span",27),a(2,"Nombre personalizado:"),o(),f(3,"br"),a(4),o(),r(5,"div",28)(6,"button",29),g("click",function(){b(e);let s=m().$implicit,c=m(2);return F(c.startEditingFavorite(s))}),a(7," \u270F\uFE0F Editar "),o(),r(8,"button",30),g("click",function(){b(e);let s=m().$implicit,c=m(2);return F(c.removeFromFavorites(s.id))}),a(9," \u{1F5D1}\uFE0F Eliminar "),o()()}if(i&2){let e=m().$implicit;l(4),y(" ",e.customName," ")}}function Ke(i,t){if(i&1&&(r(0,"div",16)(1,"figure",17),f(2,"img",18),o(),r(3,"div",19)(4,"h3",20),a(5),o(),S(6,We,7,1,"form",21)(7,Je,10,1),o()()),i&2){let e=t.$implicit,n=m(2);l(2),u("src",e.image,ae)("alt",e.nombre),l(3),C(e.nombre),l(),P(n.editingFavoriteId()===e.id?6:7)}}function Qe(i,t){if(i&1&&(r(0,"div",10),V(1,Ke,8,4,"div",16,$e),o()),i&2){let e=m();l(),j(e.favorites())}}function Xe(i,t){if(i&1){let e=E();r(0,"div",11)(1,"select",31,0),g("change",function(){b(e);let s=le(2),c=m();return F(c.charactersPerPage.set(+s.value))}),r(3,"option",32),a(4,"10"),o(),r(5,"option",33),a(6,"20"),o(),r(7,"option",34),a(8,"50"),o(),r(9,"option",35),a(10,"100"),o()(),f(11,"app-pagination",36)(12,"div",37),o()}if(i&2){let e=m();l(11),u("pages",e.totalPages())("currentPage",e.paginationService.currentPage())}}function Ye(i,t){i&1&&(r(0,"button",40),a(1," \u2B50 En favoritos "),o())}function Ze(i,t){i&1&&f(0,"span",7)}function et(i,t){if(i&1){let e=E();r(0,"button",42),g("click",function(){b(e);let s=m().$implicit,c=m(2);return F(c.addToFavorites(s))}),S(1,Ze,1,0,"span",7),a(2," \u2B50 Agregar "),o()}if(i&2){let e=m(3);u("disabled",e.addFavoriteResource.isLoading()),l(),P(e.addFavoriteResource.isLoading()?1:-1)}}function tt(i,t){if(i&1&&(r(0,"tr")(1,"td"),a(2),o(),r(3,"td"),a(4),o(),r(5,"td"),a(6),o(),r(7,"td")(8,"span"),a(9),o()(),r(10,"td")(11,"a",39),a(12," Ver Detalle "),o()(),r(13,"td"),S(14,Ye,2,0,"button",40)(15,et,3,2,"button",41),o()()),i&2){let e=t.$implicit,n=m(2);l(2),C(e.id),l(2),C(e.name),l(2),C(e.occupation),l(2),ce(de("badge badge-",e.status==="Alive"?"success":"error")),l(),y(" ",e.status," "),l(2),u("routerLink",w(9,Be,e.id)),l(3),P(n.isFavorite(e.name)?14:15)}}function it(i,t){if(i&1&&(r(0,"div",12)(1,"table",38)(2,"thead")(3,"tr")(4,"th"),a(5,"ID"),o(),r(6,"th"),a(7,"Nombre"),o(),r(8,"th"),a(9,"Ocupaci\xF3n"),o(),r(10,"th"),a(11,"Estado"),o(),f(12,"th"),r(13,"th"),a(14,"Acci\xF3n"),o()()(),r(15,"tbody"),V(16,tt,16,11,"tr",null,$e),o()()()),i&2){let e=m();l(16),j(e.simpsonsResource.value().results)}}var ze=class i{fb=p(ke);router=p(fe);simpsonsService=p(De);paginationService=p(H);favoritesService=p(J);authService=p(G);charactersPerPage=v(10);totalPages=v(0);reloadFavoritesTrigger=v(0);addFavoriteAction=v(null);deleteFavoriteAction=v(null);updateFavoriteAction=v(null);editingFavoriteId=v(null);editForm;currentUser=this.authService.user$;constructor(){this.editForm=this.fb.group({customName:["",[ee.required,ee.minLength(2)]]}),Y(()=>{this.simpsonsResource.hasValue()&&this.totalPages.set(this.simpsonsResource.value().pages)}),Y(()=>{this.currentUser.subscribe(t=>{t?this.reloadFavoritesTrigger.update(e=>e+1):this.favoritesService.favorites.set([])})})}simpsonsResource=N({params:()=>({page:this.paginationService.currentPage()-1,limit:this.charactersPerPage()}),stream:({params:t})=>this.simpsonsService.getCharactersOptions({offset:t.page,limit:t.limit})});favoritesResource=N({params:()=>({reload:this.reloadFavoritesTrigger()}),stream:({params:t})=>this.authService.user$?this.favoritesService.getFavorites():h([])});addFavoriteResource=N({params:()=>this.addFavoriteAction(),stream:({params:t})=>t?this.favoritesService.addFavorite(t.nombre,t.imagen).pipe(R(()=>{$(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("\xA1Agregado a favoritos!")})}),L(e=>(console.error("Error al agregar favorito:",e),alert("Error al agregar a favoritos: "+e.message),h(null)))):h(null)});deleteFavoriteResource=N({params:()=>this.deleteFavoriteAction(),stream:({params:t})=>t?this.favoritesService.deleteFavorite(t).pipe(R(()=>{$(()=>{this.reloadFavoritesTrigger.update(e=>e+1),alert("Eliminado de favoritos")})}),L(e=>(console.error("Error al eliminar favorito:",e),alert("Error al eliminar favorito: "+e.message),h(null)))):h(null)});updateFavoriteResource=N({params:()=>this.updateFavoriteAction(),stream:({params:t})=>t?this.favoritesService.updateFavorite(t.id,t.customName).pipe(R(()=>{$(()=>{this.reloadFavoritesTrigger.update(e=>e+1),this.cancelEditingFavorite(),alert("Nombre actualizado")})}),L(e=>(console.error("Error al actualizar favorito:",e),alert("Error al actualizar: "+e.message),h(null)))):h(null)});favorites=()=>this.favoritesService.favorites()||[];loadingFavorites=this.favoritesResource.isLoading;logout(){this.authService.logout().subscribe({next:()=>this.router.navigate(["/login"]),error:t=>console.error("Error al cerrar sesi\xF3n:",t)})}reloadFavorites(){this.reloadFavoritesTrigger.update(t=>t+1)}addToFavorites(t){let e=t.name||t.character,n=t.portrait_path||t.image||t.img||"",s;if(!e)return alert("Error: Faltan datos (nombre).");n?n.startsWith("http")?s=n:s=`https://cdn.thesimpsonsapi.com/500${n}`:s="https://placehold.co/400x300/a8c2f0/white?text=IMAGEN+API+FALLA",this.addFavoriteAction.set({nombre:e,imagen:s})}removeFromFavorites(t){confirm("\xBFEliminar de favoritos?")&&this.deleteFavoriteAction.set(t)}startEditingFavorite(t){this.editingFavoriteId.set(t.id),this.editForm.patchValue({customName:t.customName})}saveEditedFavorite(){if(this.editForm.invalid){this.editForm.markAllAsTouched();return}let t=this.editingFavoriteId(),e=this.editForm.value.customName;t&&e&&this.updateFavoriteAction.set({id:t,customName:e})}cancelEditingFavorite(){this.editingFavoriteId.set(null),this.editForm.reset()}isFavorite(t){return this.favoritesService.isFavorite(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=k({type:i,selectors:[["app-simpsons-page"]],decls:15,vars:7,consts:[["selectPerPage",""],[1,"p-4"],[3,"simpsonsCount","totalPages"],[1,"mt-8"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-2xl","font-bold"],[1,"btn","btn-sm","btn-ghost",3,"click","disabled"],[1,"loading","loading-spinner","loading-sm"],[1,"flex","justify-center","items-center","py-12"],[1,"alert","alert-info"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-3","gap-4"],[1,"flex","gap-2","items-center","h-20","mb-4","mt-8"],[1,"overflow-x-auto","mt-8"],[1,"loading","loading-spinner","loading-lg"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-current","shrink-0","w-6","h-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"card","bg-base-100","shadow-xl"],[1,"px-4","pt-4"],["onerror","this.onerror=null; this.src='https://placehold.co/400x300/a8c2f0/white?text=No+Imagen'",1,"rounded-xl","h-48","w-full","object-cover",3,"src","alt"],[1,"card-body"],[1,"card-title","text-sm"],[1,"form-control",3,"formGroup"],["type","text","formControlName","customName","placeholder","Nombre personalizado",1,"input","input-bordered","input-sm"],[1,"flex","gap-2","mt-2"],["type","button",1,"btn","btn-xs","btn-success","flex-1",3,"click"],["type","button",1,"btn","btn-xs","btn-ghost","flex-1",3,"click"],[1,"text-xs","opacity-70"],[1,"font-semibold"],[1,"card-actions","justify-end","mt-2"],[1,"btn","btn-xs","btn-ghost",3,"click"],[1,"btn","btn-xs","btn-error",3,"click"],[1,"select","select-bordered","w-32",3,"change"],["value","10"],["value","20"],["value","50"],["value","100"],[3,"pages","currentPage"],[1,"flex","flex-1"],[1,"table"],[1,"btn","btn-sm","btn-primary",3,"routerLink"],["disabled","",1,"btn","btn-sm","btn-ghost"],[1,"btn","btn-sm","btn-primary",3,"disabled"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"]],template:function(e,n){if(e&1&&(r(0,"section",1),f(1,"app-hero-simpsons",2),r(2,"section")(3,"div",3)(4,"div",4)(5,"h2",5),a(6,"\u2B50 Mis Favoritos"),o(),r(7,"button",6),g("click",function(){return n.reloadFavorites()}),S(8,Ge,1,0,"span",7)(9,He,1,0),o()(),S(10,Oe,2,0,"div",8)(11,Ue,5,0,"div",9)(12,Qe,3,0,"div",10),o()(),S(13,Xe,13,2,"div",11),S(14,it,18,0,"div",12),o()),e&2){let s;l(),u("simpsonsCount",((s=n.simpsonsResource.value())==null?null:s.count)??0)("totalPages",n.totalPages()),l(6),u("disabled",n.loadingFavorites()),l(),P(n.loadingFavorites()?8:9),l(2),P(n.loadingFavorites()?10:n.favorites().length===0?11:12),l(3),P(n.totalPages()>0?13:-1),l(),P(n.simpsonsResource.hasValue()?14:-1)}},dependencies:[ge,_e,B,U,W,we,Se,Ce,ye,xe,be,Fe,Ee,Pe],encapsulation:2})};export{ze as SimpsonsPage};
